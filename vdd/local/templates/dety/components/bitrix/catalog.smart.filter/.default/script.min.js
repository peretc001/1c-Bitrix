function JCSmartFilter(e,t,i){this.ajaxURL=e,this.form=null,this.timer=null,this.cacheKey="",this.cache=[],this.popups=[],this.viewMode=t,i&&i.SEF_SET_FILTER_URL&&(this.bindUrlToButton("set_filter",i.SEF_SET_FILTER_URL),this.sef=!0),i&&i.SEF_DEL_FILTER_URL&&this.bindUrlToButton("del_filter",i.SEF_DEL_FILTER_URL)}document.addEventListener("DOMContentLoaded",()=>{if(document.querySelector("[data-brand]")){const e=[...document.querySelectorAll("[data-brand]")];let t=document.querySelector(".brands-filter");filterBrands=t=>{let a=t.target.value;for(i=0;i<e.length;i++){e[i].textContent.toLocaleUpperCase().indexOf(a.toLocaleUpperCase())>-1?e[i].style.display="":e[i].style.display="none"}},t.addEventListener("input",filterBrands)}if(document.querySelector(".min-price")){const t=$(".min-price"),i=$(".max-price");var e=$("#slider-range").slider({min:parseInt(t.attr("min")),max:parseInt(i.attr("max")),values:[0,parseInt(i.val())],range:!0,slide:function(e,a){0===a.handleIndex?t.val(a.values[0]):i.val(a.values[1]),smartFilter.keyup(this)}});t.on("keyup",(function(){let a=parseInt($(this).val())<parseInt(i.val())?parseInt($(this).val()):parseInt(i.val());e.slider("values",0,a),e.slider("values",1,parseInt(i.val())),t.val(a)})),i.on("keyup",(function(){let a=parseInt($(this).val())>parseInt(t.val())?parseInt($(this).val()):parseInt(t.val());e.slider("values",0,parseInt(t.val())),e.slider("values",1,a),i.val(a)}))}}),JCSmartFilter.prototype.keyup=function(e){this.timer&&clearTimeout(this.timer),this.timer=setTimeout(BX.delegate((function(){this.reload(e)}),this),500)},JCSmartFilter.prototype.click=function(e){this.timer&&clearTimeout(this.timer),this.timer=setTimeout(BX.delegate((function(){this.reload(e)}),this),500)},JCSmartFilter.prototype.reload=function(e){if(""!==this.cacheKey)return this.timer&&clearTimeout(this.timer),void(this.timer=setTimeout(BX.delegate((function(){this.reload(e)}),this),1e3));if(this.cacheKey="|",this.position=BX.pos(e,!0),this.form=BX.findParent(e,{tag:"form"}),this.form){var t=[];t[0]={name:"ajax",value:"y"},this.gatherInputsValues(t,BX.findChildren(this.form,{tag:new RegExp("^(input|select)$","i")},!0));for(var i=0;i<t.length;i++)this.cacheKey+=t[i].name+":"+t[i].value+"|";if(this.cache[this.cacheKey])this.curFilterinput=e,this.postHandler(this.cache[this.cacheKey],!0);else{if(this.sef)BX("set_filter").disabled=!0;this.curFilterinput=e,BX.ajax.loadJSON(this.ajaxURL,this.values2post(t),BX.delegate(this.postHandler,this))}}},JCSmartFilter.prototype.updateItem=function(e,t){if("N"===t.PROPERTY_TYPE||t.PRICE){var i=window["trackBar"+e];!i&&t.ENCODED_ID&&(i=window["trackBar"+t.ENCODED_ID]),i&&t.VALUES&&(t.VALUES.MIN&&(t.VALUES.MIN.FILTERED_VALUE?i.setMinFilteredValue(t.VALUES.MIN.FILTERED_VALUE):i.setMinFilteredValue(t.VALUES.MIN.VALUE)),t.VALUES.MAX&&(t.VALUES.MAX.FILTERED_VALUE?i.setMaxFilteredValue(t.VALUES.MAX.FILTERED_VALUE):i.setMaxFilteredValue(t.VALUES.MAX.VALUE)))}else if(t.VALUES)for(var a in t.VALUES)if(t.VALUES.hasOwnProperty(a)){var s=t.VALUES[a],r=BX(s.CONTROL_ID);if(r){var n=document.querySelector('[data-role="label_'+s.CONTROL_ID+'"]');s.DISABLED?n?BX.addClass(n,"disabled"):BX.addClass(r.parentNode,"disabled"):n?BX.removeClass(n,"disabled"):BX.removeClass(r.parentNode,"disabled"),s.hasOwnProperty("ELEMENT_COUNT")&&(n=document.querySelector('[data-role="count_'+s.CONTROL_ID+'"]'))&&(n.innerHTML=s.ELEMENT_COUNT)}}},JCSmartFilter.prototype.postHandler=function(e,t){var i,a,s=BX("modef"),r=BX("modef_num"),n=BX("set_filter");if(e&&e.ITEMS){for(var l in this.popups)this.popups.hasOwnProperty(l)&&this.popups[l].destroy();for(var o in this.popups=[],e.ITEMS)e.ITEMS.hasOwnProperty(o)&&this.updateItem(o,e.ITEMS[o]);s&&r&&(r.innerHTML=e.ELEMENT_COUNT,i=BX.findChildren(s,{tag:"A"},!0),n.classList.add("hasResult"),e.ELEMENT_COUNT>0&&(n.value="Показать ("+e.ELEMENT_COUNT+")",s.classList.contains("is-empty")&&s.classList.remove("is-empty"),n.classList.contains("is-empty")&&n.classList.remove("is-empty")),0==e.ELEMENT_COUNT&&(n.value="Ничего не найдено",n.classList.add("is-empty"),s.classList.add("is-empty")),e.FILTER_URL&&i&&(i[0].href=BX.util.htmlspecialcharsback(e.FILTER_URL)),e.FILTER_AJAX_URL&&e.COMPONENT_CONTAINER_ID&&(BX.unbindAll(i[0]),BX.bind(i[0],"click",(function(t){return a=BX.util.htmlspecialcharsback(e.FILTER_AJAX_URL),BX.ajax.insertToNode(a,e.COMPONENT_CONTAINER_ID),BX.PreventDefault(t)}))),e.INSTANT_RELOAD&&e.COMPONENT_CONTAINER_ID?(a=BX.util.htmlspecialcharsback(e.FILTER_AJAX_URL),BX.ajax.insertToNode(a,e.COMPONENT_CONTAINER_ID)):("none"===s.style.display&&(s.style.display="inline-block"),"VERTICAL"==this.viewMode&&BX.findChild(BX.findParent(this.curFilterinput,{class:"bx-filter-parameters-box"}),{class:"bx-filter-container-modef"},!0,!1).appendChild(s),e.SEF_SET_FILTER_URL&&this.bindUrlToButton("set_filter",e.SEF_SET_FILTER_URL)))}this.sef&&(BX("set_filter").disabled=!1);t||""===this.cacheKey||(this.cache[this.cacheKey]=e),this.cacheKey=""},JCSmartFilter.prototype.bindUrlToButton=function(e,t){var i,a,s=BX(e);if(s){"submit"==s.type&&(s.type="button"),BX.bind(s,"click",(i=t,a=function(e){return window.location.href=e,!1},function(){return a(i)}))}},JCSmartFilter.prototype.gatherInputsValues=function(e,t){if(t)for(var i=0;i<t.length;i++){var a=t[i];if(!a.disabled&&a.type)switch(a.type.toLowerCase()){case"text":case"textarea":case"password":case"hidden":case"select-one":a.value.length&&(e[e.length]={name:a.name,value:a.value});break;case"radio":case"checkbox":a.checked&&(e[e.length]={name:a.name,value:a.value});break;case"select-multiple":for(var s=0;s<a.options.length;s++)a.options[s].selected&&(e[e.length]={name:a.name,value:a.options[s].value})}}},JCSmartFilter.prototype.values2post=function(e){for(var t=[],i=t,a=0;a<e.length;){var s=e[a].name.indexOf("[");if(-1==s)i[e[a].name]=e[a].value,i=t,a++;else{var r=e[a].name.substring(0,s),n=e[a].name.substring(s+1);i[r]||(i[r]=[]);var l=n.indexOf("]");-1==l?(i=t,a++):0==l?(i=i[r],e[a].name=""+i.length):(i=i[r],e[a].name=n.substring(0,l)+n.substring(l+1))}}return t},JCSmartFilter.prototype.hideFilterProps=function(e){var t=e.parentNode,i=t.querySelector("[data-role='bx_filter_block']"),a=t.querySelector("[data-role='prop_angle']");if(BX.hasClass(t,"bx-active"))BX.addClass(a,"down"),BX.removeClass(a,"up"),new BX.easing({duration:300,start:{opacity:1,height:i.offsetHeight},finish:{opacity:0,height:0},transition:BX.easing.transitions.quart,step:function(e){i.style.opacity=e.opacity,i.style.height=e.height+"px"},complete:function(){i.setAttribute("style",""),BX.removeClass(t,"bx-active")}}).animate();else{BX.addClass(t,"bx-active"),BX.removeClass(a,"down"),BX.addClass(a,"up"),i.style.display="block",i.style.opacity=0,i.style.height="auto";var s=i.offsetHeight;i.style.height=0,new BX.easing({duration:300,start:{opacity:0,height:0},finish:{opacity:1,height:s},transition:BX.easing.transitions.quart,step:function(e){i.style.opacity=e.opacity,i.style.height=e.height+"px"},complete:function(){}}).animate()}},JCSmartFilter.prototype.showDropDownPopup=function(e,t){var i=e.querySelector('[data-role="dropdownContent"]');this.popups["smartFilterDropDown"+t]=BX.PopupWindowManager.create("smartFilterDropDown"+t,e,{autoHide:!0,offsetLeft:0,offsetTop:3,overlay:!1,draggable:{restrict:!0},closeByEsc:!0,content:BX.clone(i)}),this.popups["smartFilterDropDown"+t].show()},JCSmartFilter.prototype.selectDropDownItem=function(e,t){this.keyup(BX(t)),BX.findParent(BX(t),{className:"bx-filter-select-container"},!1).querySelector('[data-role="currentOption"]').innerHTML=e.innerHTML,BX.PopupWindowManager.getCurrentPopup().close()},BX.namespace("BX.Iblock.SmartFilter");
//# sourceMappingURL=script.map.js